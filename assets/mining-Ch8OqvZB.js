import{d as M}from"./pinia-BpcJfL22.js";import{a as m}from"./axios-gbnyky6P.js";import{_ as f,l as y}from"./index-BNYCpaa6.js";import{a1 as d,a2 as u,a3 as _,a4 as I,a5 as n,r as h,o as b,s as A,a7 as $,y as S,Z as v,$ as p,a9 as U}from"./@vue-DcaRQrEV.js";import"./@townsquarelabs-BS-uiH3p.js";import"./@tonconnect-Bdfz1Hmc.js";import"./tweetnacl-util-2xfJoBJT.js";import"./classnames-CVOySMdS.js";import"./tweetnacl-B8ikFTel.js";import"./ua-parser-js-tCHOh2cX.js";import"./deepmerge-D8huMqX6.js";import"./vue-i18n-DnT-njvb.js";import"./@intlify-Du3kGuGm.js";import"./vue-router-esc5Ehka.js";import"./vue-cookies-oMoGE7eu.js";import"./vuetify-Cn8jMMVq.js";import"./vue-lazyload-BBtGN9-g.js";const C=M("miningStore",{state:()=>{var t,i,s,e;return{userId:((e=(s=(i=(t=window.Telegram)==null?void 0:t.WebApp)==null?void 0:i.initDataUnsafe)==null?void 0:s.user)==null?void 0:e.id)||null,userPhotoUrl:"",isMiningActive:!1,loading:!1,endTime:null,formattedTimeLeft:"00:00:00",balance:0,dayTotal:0,timerInterval:null,serverTimeOffset:0,miningStartTime:null}},actions:{setUserIdFromTelegram(t){this.userId=t},async fetchUserPhoto(){var t,i,s;try{const e=await m.get(`https://4v-news-api.azurewebsites.net/Games4V/User/Get?TelegramUserId=${this.userId}`);(s=(i=(t=e.data)==null?void 0:t.photos)==null?void 0:i[0])!=null&&s.userPicUrl?this.userPhotoUrl=e.data.photos[0].userPicUrl:console.warn("Аватар пользователя отсутствует.")}catch(e){console.error("Ошибка получения аватара пользователя:",e)}},async fetchUserStatistics(){try{const t=await m.get(`https://4v-news-api.azurewebsites.net/Games4V/User/Statistics?TelegramUserId=${this.userId}`);t.data?(this.balance=t.data.total,this.dayTotal=t.data.dayTotal):console.warn("Ошибка получения статистики пользователя.")}catch(t){console.error("Ошибка при вызове API:",t)}},async syncServerTime(){try{const t=await m.get("https://4v-news-api.azurewebsites.net/Maintenance/ServerDateTime"),i=new Date(t.data.dateTimeUtc),s=new Date;this.serverTimeOffset=i.getTime()-s.getTime()}catch(t){console.error("Ошибка синхронизации с сервером:",t)}},startTimerFromSeconds(t){const i=new Date;this.endTime=new Date(i.getTime()+t*1e3),this.updateTimer(),this.timerInterval=setInterval(this.updateTimer,1e3)},updateTimer(){const t=new Date,i=this.endTime-t;if(i<=0)clearInterval(this.timerInterval),this.isMiningActive=!1,this.formattedTimeLeft="00:00:00";else{const s=Math.floor(i/1e3);this.formattedTimeLeft=this.formatTime(s)}},formatTime(t){const i=Math.floor(t/3600),s=Math.floor(t%3600/60),e=t%60;return`${String(i).padStart(2,"0")}:${String(s).padStart(2,"0")}:${String(e).padStart(2,"0")}`},async checkMiningStatus(){try{const t=await m.get(`https://4v-news-api.azurewebsites.net/Games4V/Mining/Get?TelegramUserId=${this.userId}`);if(t.data.isSuccess){const i=t.data.timeLeftInSec;i===null?this.isMiningActive=!1:(this.isMiningActive=!0,this.startTimerFromSeconds(i))}else console.error("Ошибка проверки статуса майнинга:",t.data.errors)}catch(t){console.error("Ошибка проверки статуса майнинга:",t)}},async startMining(){this.loading=!0;try{const t=await m.post(`https://4v-news-api.azurewebsites.net/Games4V/Mining/Create?TelegramUserId=${this.userId}`);t.data.isSuccess?(this.isMiningActive=!0,this.miningStartTime=new Date,this.startTimerFromSeconds(4*60*60),this.fetchUserStatistics()):console.error("Ошибка при старте майнинга:",t.data.errors)}catch(t){console.error("Ошибка старта майнинга:",t)}finally{this.loading=!1}},saveMiningState(){const t={isMiningActive:this.isMiningActive,miningStartTime:this.miningStartTime};localStorage.setItem("miningData",JSON.stringify(t))},loadMiningState(){const t=JSON.parse(localStorage.getItem("miningData"));t&&(this.isMiningActive=t.isMiningActive,this.miningStartTime=new Date(t.miningStartTime))},async refreshData(){await this.fetchUserPhoto(),await this.fetchUserStatistics(),await this.checkMiningStatus()}}}),D="/img/logoboss.webp",N={},x=t=>(_("data-v-9e8c6455"),t=t(),I(),t),O={class:"coin-container"},k=x(()=>n("img",{class:"img-fluid",style:{"max-width":"280px","max-height":"280px",position:"relative"},src:D,alt:"Coin Image"},null,-1)),E=[k];function G(t,i,s,e,c,l){return d(),u("div",O,E)}const R=f(N,[["render",G],["__scopeId","data-v-9e8c6455"]]),P={components:{logo:R,level:y},setup(){const t=C(),i=h(""),s=h(!0),e=h(null),c=h(!1),l=["НАЧАТЬ МАЙНИНГ","START MINING","ابدأ التعدين","开始挖矿","COMENZAR MINERÍA","COMMENCER MINER","खनन शुरू करें","INIZIA MINING","マイニング開始","마이닝 시작","ROZPOCZNIJ GÓRNICTWO","COMEÇAR MINERAÇÃO","MADENCІЛІГЕ БАШЛА","РОЗПОЧАТИ МАЙНІНГ"];let a=0,o=null;const r=()=>{a=(a+1)%l.length,i.value=l[a]},T=()=>{s.value=!s.value,localStorage.setItem("isSoundOn",s.value),e.value&&(e.value.muted=!s.value)},w=async()=>{o&&clearInterval(o);try{e.value&&s.value&&e.value.play(),await t.startMining(),await t.getCoinBalance()}catch(g){console.log(`Ошибка при запуске майнинга: ${g.message}`)}};return b(()=>{const g=localStorage.getItem("isSoundOn");g!==null&&(s.value=g==="true"),r(),o=setInterval(r,1e3),setTimeout(()=>{c.value=!0},1e3),t.syncServerTime().then(async()=>{await t.checkMiningStatus(),await t.getCoinBalance()})}),A(()=>{o&&clearInterval(o)}),{miningStore:t,handleStartMining:w,buttonText:i,startSound:e,isSoundOn:s,toggleSound:T,showContent:c}}},B=t=>(_("data-v-071321b5"),t=t(),I(),t),L={class:"mining-app"},z={key:0,class:"center-content"},V=["disabled"],Z={key:1,class:"text-white center-content"},F=B(()=>n("br",null,null,-1)),J={class:"fs-2 fw-bold"},W={ref:"startSound",src:"/img/1.mp3"};function j(t,i,s,e,c,l){const a=p("logo"),o=p("level");return d(),u("div",L,[n("div",{class:"sound-icon",onClick:i[0]||(i[0]=(...r)=>e.toggleSound&&e.toggleSound(...r)),style:{cursor:"pointer","margin-top":"130px"}},[n("i",{style:{color:"white"},class:$(e.isSoundOn?"bi bi-volume-up":"bi bi-volume-mute"),"aria-hidden":"true"},null,2)]),S(a,{style:{cursor:"pointer","margin-top":"150px"}}),e.showContent&&!e.miningStore.isMiningActive?(d(),u("div",z,[n("button",{class:"btn-main fw-bold text-white mt-5",onClick:i[1]||(i[1]=(...r)=>e.handleStartMining&&e.handleStartMining(...r)),disabled:e.miningStore.loading||e.miningStore.isMiningActive},[n("span",null,v(t.$t("startMining")),1)],8,V)])):(d(),u("div",Z,[S(o,{style:{cursor:"pointer"}}),F,n("span",J,v(e.miningStore.formattedTimeLeft),1)])),n("audio",W,null,512)])}const q=f(P,[["render",j],["__scopeId","data-v-071321b5"]]),H={components:{card:q},data:()=>({})};function K(t,i,s,e,c,l){const a=p("card");return d(),U(a,{class:""})}const ut=f(H,[["render",K],["__scopeId","data-v-3339a27c"]]);export{ut as default};

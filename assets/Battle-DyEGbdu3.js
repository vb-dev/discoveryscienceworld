import{d as E}from"./pinia-lwTlpTIT.js";import{_ as z}from"./index-BmeFPldV.js";import{r as w,e as m,o as N,w as F,f as _,g as k,j as b,m as v,F as i,L as f,J as u,G as M,l as S,E as V,H as R,A as W,B as j,af as p,ag as L,ah as Q}from"./@vue-__l9B_85.js";import"./@townsquarelabs-16PzzAQ_.js";import"./@tonconnect-M86Ec7Bf.js";import"./tweetnacl-util-2xfJoBJT.js";import"./classnames-CVOySMdS.js";import"./tweetnacl-B8ikFTel.js";import"./ua-parser-js-BKpq8BhR.js";import"./deepmerge-D8huMqX6.js";import"./axios-C8DqakIB.js";import"./vue-i18n-BYwOkJVi.js";import"./@intlify-Du3kGuGm.js";import"./vue-router-LHJ1DXGb.js";import"./vue-cookies-oMoGE7eu.js";/* empty css             */import"./@vuepic-DxQbSENG.js";import"./date-fns-C7_rVUPb.js";import"./vuetify-BE4X0aUx.js";import"./vue-lazyload-f4_DPajf.js";const G=async(t,e)=>{try{const s=doc(db,"users",t);(await getDoc(s)).exists()?console.log("User document loaded"):(await setDoc(s,{userId:t,userName:e,pointsData:{},totalPoints:0,isMining:!1,miningStartedAt:null,miningEndsAt:null,dailyResetTime:y(!1),lastUpdated:serverTimestamp(),isTestMode:!1}),console.log("User document created"))}catch(s){console.error("Error creating or loading user document: ",s)}},X=E("cardsMining",{state:()=>({pointsData:{},totalPoints:0,userId:"guest",userName:"guest",isMining:!1,miningStartedAt:null,miningEndsAt:null,dailyResetTime:y(!1),isTestMode:!1,users:[],bank:0,correctAnswer:null,userAnswers:{},stakesA:0,stakesB:0}),actions:{setUser(t,e){this.userId=t,this.userName=e,G(t,e)},async loadUserData(){const t=doc(db,"users",this.userId),e=await getDoc(t);if(e.exists()){const s=e.data();this.totalPoints=s.totalPoints,this.pointsData=s.pointsData,this.isMining=s.isMining||!1,this.miningStartedAt=s.miningStartedAt||null,this.miningEndsAt=s.miningEndsAt||null,this.dailyResetTime=s.dailyResetTime||y(this.isTestMode),this.isTestMode=s.isTestMode||!1,console.log("User data loaded:",s)}else await setDoc(t,{userId:this.userId,userName:this.userName,totalPoints:this.totalPoints,pointsData:this.pointsData,isMining:this.isMining,miningStartedAt:this.miningStartedAt,miningEndsAt:this.miningEndsAt,dailyResetTime:y(this.isTestMode),lastUpdated:serverTimestamp(),isTestMode:this.isTestMode}),console.log("User document initialized.")},async saveUserData(){const t=doc(db,"users",this.userId);await updateDoc(t,{totalPoints:this.totalPoints,isMining:this.isMining,miningEndsAt:this.miningEndsAt}),console.log("User data saved.")},async updateTopUsersCollection(){const t=collection(db,"topUsers");console.log("topUsersRef created:",t);const e=doc(t,this.userId);await setDoc(e,{userId:this.userId,userName:this.userName||"Unknown",totalPoints:this.totalPoints,lastUpdated:serverTimestamp()},{merge:!0}),console.log("User document updated/created in topUsers");const s=query(t,orderBy("totalPoints","desc"));console.log("topUsersQuery created:",s);const n=await getDocs(s);console.log("topUsersSnapshot fetched:",n.size),this.users=n.docs.map(a=>a.data()),console.log("Top users loaded and sorted:",this.users)},async decrementPoints(t){this.totalPoints-=t,await this.saveUserData(),console.log("Points decremented by",t)},async checkAndStartMining(t){if(await this.loadUserData(),this.isMining)return console.log("Mining is already in progress."),!1;this.isMining=!0,this.miningStartedAt=Date.now(),this.miningEndsAt=this.miningStartedAt+144e5;const e=this.getPoints(t)+4;return this.totalPoints+=4,await this.updateCardPoints(t,e,!0,this.miningStartedAt),await this.saveUserData(),console.log("Mining started."),setTimeout(async()=>{this.finishMining()},144e5),!0},async finishMining(){this.isMining=!1,this.miningStartedAt=null,this.miningEndsAt=null,Object.keys(this.pointsData).forEach(t=>{this.pointsData[t].isButtonDisabled=!1}),await this.saveUserData(),console.log("Mining finished and button re-enabled.")},async updateCardPoints(t,e,s,n){this.pointsData[t]||(this.pointsData[t]={points:0,isButtonDisabled:!1,lastClickedTime:null}),this.pointsData[t].points=e,this.pointsData[t].isButtonDisabled=s,this.pointsData[t].lastClickedTime=n,await this.saveUserData()},async resetPoints(){for(const t in this.pointsData)this.pointsData[t]&&(this.pointsData[t].points=0);this.dailyResetTime=y(this.isTestMode),await this.saveUserData(),console.log("Points reset at:",new Date().toLocaleTimeString())},getPoints(t){return this.pointsData[t]?this.pointsData[t].points:0},calculateNextResetTime(t){const e=new Date;if(t)return e.getTime()+6e4;{let s=new Date(e.getFullYear(),e.getMonth(),e.getDate(),3,0,0);return e>=s&&s.setDate(s.getDate()+1),s.getTime()}},async toggleTestMode(){this.isTestMode=!this.isTestMode,this.dailyResetTime=this.calculateNextResetTime(this.isTestMode),await this.saveUserData()},async loadQuizData(){const t=doc(db,"quiz","current"),e=await getDoc(t);if(e.exists()){const s=e.data();this.bank=s.bank!==void 0?s.bank:0,this.correctAnswer=s.correctAnswer||null,this.userAnswers=s.userAnswers||{},this.stakesA=s.stakesA!==void 0?s.stakesA:0,this.stakesB=s.stakesB!==void 0?s.stakesB:0}else await setDoc(t,{bank:0,correctAnswer:null,userAnswers:{},stakesA:0,stakesB:0})},async addToBank(t,e){const s=doc(db,"quiz","current"),n=await getDoc(s),h=(n.exists()&&n.data().bank?n.data().bank:0)+t,l=n.exists()&&n.data().stakesA?n.data().stakesA:0,c=n.exists()&&n.data().stakesB?n.data().stakesB:0;let r=l,d=c;e==="А"?r+=t:e==="Б"&&(d+=t),await updateDoc(s,{bank:h,stakesA:r,stakesB:d}),this.bank=h,this.stakesA=r,this.stakesB=d},async recordUserAnswer(t,e){const s=doc(db,"quiz","current");await updateDoc(s,{[`userAnswers.${t}`]:e}),this.userAnswers[t]=e},async setCorrectAnswer(t){this.correctAnswer=t;const e=doc(db,"quiz","current");await updateDoc(e,{correctAnswer:t}),await this.distributeWinnings()},async distributeWinnings(){const t=Object.keys(this.userAnswers).filter(s=>this.userAnswers[s]===this.correctAnswer);if(t.length>0){const s=this.bank,n=Math.floor(s/t.length);let a=s%t.length;for(const h of t){const l=doc(db,"users",h),c=await getDoc(l);if(c.exists()){const r=c.data(),d=n+(a>0?1:0);a>0&&a--,await updateDoc(l,{totalPoints:r.totalPoints+d})}}}this.bank=0,this.stakesA=0,this.stakesB=0,this.userAnswers={};const e=doc(db,"quiz","current");await setDoc(e,{bank:0,correctAnswer:null,userAnswers:{},stakesA:0,stakesB:0})},async loadTopUsers(){const t=query(collection(db,"topUsers"),orderBy("totalPoints","desc")),e=await getDocs(t);this.users=e.docs.map(s=>s.data()),console.log("Top users loaded:",this.users)},startPolling(){const t=this.userId,e=doc(db,"users",t);onSnapshot(e,n=>{if(n.exists()){const a=n.data();this.pointsData=a.pointsData,this.totalPoints=a.totalPoints,this.isMining=a.isMining||!1,this.miningStartedAt=a.miningStartedAt||null,this.miningEndsAt=a.miningEndsAt||null,this.dailyResetTime=a.dailyResetTime||this.calculateNextResetTime(this.isTestMode),console.log("Data updated from Firestore:",this.pointsData)}});const s=doc(db,"quiz","current");onSnapshot(s,n=>{if(n.exists()){const a=n.data();this.bank=a.bank,this.correctAnswer=a.correctAnswer,this.userAnswers=a.userAnswers,this.stakesA=a.stakesA,this.stakesB=a.stakesB}})},loadPointsFromLocalStorage(){const t=localStorage.getItem(`points_${this.userId}`);t&&(this.totalPoints=parseInt(t,10))},savePointsToLocalStorage(){localStorage.setItem(`points_${this.userId}`,this.totalPoints.toString())}}});function y(t){const e=new Date;if(t)return e.getTime()+6e4;{let s=new Date(e.getFullYear(),e.getMonth(),e.getDate(),3,0,0);return e>=s&&s.setDate(s.getDate()+1),s.getTime()}}const O={setup(){const t=X(),e=w(""),s=w(""),n=w(!1),a=w(!1),h=["1227459883","389603194"],l=m(()=>t.bank),c=m(()=>t.stakesA),r=m(()=>t.stakesB),d=m(()=>t.userAnswers),x=w("Usik or Fury?!"),T=w("Usik or Fury?!Who will win in a rematch: Usik (A) or Fury (B)?"),B=w(["А","Б"]),g=m(()=>t.totalPoints),A=m(()=>g.value>=10),P=m(()=>{const o=c.value+r.value;return o?c.value/o*100:0}),I=m(()=>{const o=c.value+r.value;return o?r.value/o*100:0}),C=async o=>{if(console.log("Submitting answer:",o),console.log("UserId:",e.value),A.value&&!n.value){n.value=!0;try{alert("Bid accepted!"),await t.decrementPoints(10),await t.addToBank(10,o),await t.recordUserAnswer(e.value,o)}finally{n.value=!1}}},q=async o=>{console.log("Choosing correct answer:",o),await t.setCorrectAnswer(o)};return N(async()=>{var o;if(window.Telegram&&window.Telegram.WebApp){const U=((o=window.Telegram.WebApp.initDataUnsafe)==null?void 0:o.user)||{};s.value=U.username||"Guest",e.value=U.id?U.id.toString():"Unknown",t.setUser(e.value,s.value),h.includes(e.value)&&(a.value=!0)}else e.value=t.userId;await t.loadUserData(),await t.loadQuizData(),t.startPolling()}),F(()=>t.userAnswers,o=>{console.log("User answers updated:",o)}),{quizTitle:x,quizDescription:T,answers:B,canParticipate:A,submitAnswer:C,chooseCorrectAnswer:q,bank:l,stakesA:c,stakesB:r,userId:e,userName:s,userAnswers:d,percentageA:P,percentageB:I,isSubmitting:n,isAdmin:a}}},D=t=>(L("data-v-c06b8935"),t=t(),Q(),t),Y={class:"dark"},H={style:{"font-size":"14px"}},J=D(()=>i("img",{alt:"image",style:{width:"50px"},src:"https://cdn3d.iconscout.com/3d/premium/thumb/boxing-gloves-5236962-4379967.png?f=webp"},null,-1)),K=D(()=>i("br",null,null,-1)),Z=["disabled","onClick"],$={class:"progress mx-2"},tt=["aria-valuenow"],st={class:"progress mt-2 mx-2"},et=["aria-valuenow"],nt={style:{"font-size":"12px"},class:"fw-bold"},at={class:"text-warning fs-6"},it={style:{"font-size":"12px"},class:"fw-bold"},ot={class:"text-warning fs-6"},rt={style:{"font-size":"12px"},class:"fw-bold"},ct={class:"text-warning fs-6"},lt=D(()=>i("br",null,null,-1)),dt=["onClick"],ut=D(()=>i("br",null,null,-1)),ht=D(()=>i("br",null,null,-1)),gt=D(()=>i("br",null,null,-1));function mt(t,e,s,n,a,h){const l=p("v-img"),c=p("v-card-title"),r=p("v-divider"),d=p("v-card-subtitle"),x=p("v-card-text"),T=p("v-card-actions"),B=p("v-card");return _(),k(M,null,[b(B,{class:"text-white text-center dark",style:{"margin-top":"110px"}},{default:v(()=>[i("span",Y,[b(l,{alt:"Image",style:{"box-shadow":"2px 2px 2px 2px rgb(190, 15, 15)"},src:"https://cdn.fakty.com.ua/wp-content/uploads/2024/01/08/usyk-fyuri-promo-632x356.jpg",height:"200px",class:"white--text align-end",cover:""})]),b(c,{class:"text-h6 fw-bold"},{default:v(()=>[f(u(n.quizTitle),1)]),_:1}),b(x,null,{default:v(()=>[i("p",H,u(n.quizDescription),1),J,K,(_(!0),k(M,null,S(n.answers,(g,A)=>(_(),k("button",{key:A,disabled:!n.canParticipate||n.userAnswers[n.userId]!==void 0||n.isSubmitting,class:V(["ma-2 bt btn btn-light text-white",{"btn-green":n.userAnswers[n.userId]===g}]),onClick:P=>n.submitAnswer(g)},u(g),11,Z))),128)),b(r,{class:"my-4"}),i("div",$,[i("div",{class:"progress-bar bg-primary",role:"progressbar",style:R({width:n.percentageA+"%"}),"aria-valuenow":n.percentageA,"aria-valuemin":"0","aria-valuemax":"100"},u(Math.round(n.percentageA))+"% на А ",13,tt)]),i("div",st,[i("div",{class:"progress-bar bg-success",role:"progressbar",style:R({width:n.percentageB+"%"}),"aria-valuenow":n.percentageB,"aria-valuemin":"0","aria-valuemax":"100"},u(Math.round(n.percentageB))+"% на Б ",13,et)]),b(d,{class:"text-center mt-4 fw-bold"},{default:v(()=>[i("h6",nt,[f(" General bank: "),i("span",at,u(n.bank),1),f(" FVX ")]),i("h6",it,[f(" Bet on A: "),i("span",ot,u(n.stakesA),1),f(" FVX ")]),i("h6",rt,[f(" Bet on B: "),i("span",ct,u(n.stakesB),1),f(" FVX ")])]),_:1})]),_:1}),lt,n.isAdmin?(_(),W(T,{key:0,class:"justify-center"},{default:v(()=>[(_(!0),k(M,null,S(n.answers,(g,A)=>(_(),k("button",{key:"admin-"+A,class:"btn ma-2 mb-16 bg-warning text-white fw-bold",onClick:P=>n.chooseCorrectAnswer(g)}," Админ "+u(g),9,dt))),128))]),_:1})):j("",!0)]),_:1}),ut,ht,gt],64)}const pt=z(O,[["render",mt],["__scopeId","data-v-c06b8935"]]),wt={components:{bet:pt},props:{isDarkMode:{type:Boolean,required:!0}}},ft={class:""};function _t(t,e,s,n,a,h){const l=p("bet");return _(),k("div",ft,[b(l)])}const Vt=z(wt,[["render",_t],["__scopeId","data-v-062526db"]]);export{Vt as default};

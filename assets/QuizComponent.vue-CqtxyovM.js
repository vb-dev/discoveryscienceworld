import{d as O}from"./pinia-C1HJPG_8.js";import{d as l,l as P,s as U,e as E,u as y,m as q,q as N,n as F,p as V,t as Q}from"./@firebase-BQX1siTm.js";import{d as r,_ as Y}from"./index-DZl5TSEl.js";import{r as f,e as p,o as H,w as J,af as A,f as b,g as x,j as D,m as T,F as i,L as k,J as h,G as I,l as W,E as K,H as j,A as Z,B as $,ag as tt,ah as st}from"./@vue-Dcb7a58U.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./@townsquarelabs-BgPXdIpE.js";import"./@tonconnect-M86Ec7Bf.js";import"./tweetnacl-util-2xfJoBJT.js";import"./classnames-CVOySMdS.js";import"./tweetnacl-B8ikFTel.js";import"./ua-parser-js-BKpq8BhR.js";import"./deepmerge-D8huMqX6.js";import"./axios-C8DqakIB.js";import"./vue-i18n-Dvg6AuFs.js";import"./@intlify-YGwFW6EB.js";import"./vue-router-BQMxiK41.js";import"./firebase-Byqy4Vnd.js";import"./vue-cookies-oMoGE7eu.js";/* empty css             */import"./@vuepic-BjnJ3yft.js";import"./date-fns-C7_rVUPb.js";import"./vuetify-DU_HBewe.js";import"./vue-lazyload-BfwpdwU2.js";const et=async(t,e)=>{try{const s=l(r,"users",t);(await P(s)).exists()?console.log("User document loaded"):(await U(s,{userId:t,userName:e,pointsData:{},totalPoints:0,isMining:!1,miningStartedAt:null,miningEndsAt:null,dailyResetTime:B(!1),lastUpdated:E(),isTestMode:!1}),console.log("User document created"))}catch(s){console.error("Error creating or loading user document: ",s)}},at=O("cardsMining",{state:()=>({pointsData:{},totalPoints:0,userId:"guest",userName:"guest",isMining:!1,miningStartedAt:null,miningEndsAt:null,dailyResetTime:B(!1),isTestMode:!1,users:[],bank:0,correctAnswer:null,userAnswers:{},stakesA:0,stakesB:0}),actions:{setUser(t,e){this.userId=t,this.userName=e,et(t,e)},async loadUserData(){const t=l(r,"users",this.userId),e=await P(t);if(e.exists()){const s=e.data();this.totalPoints=s.totalPoints,this.pointsData=s.pointsData,this.isMining=s.isMining||!1,this.miningStartedAt=s.miningStartedAt||null,this.miningEndsAt=s.miningEndsAt||null,this.dailyResetTime=s.dailyResetTime||B(this.isTestMode),this.isTestMode=s.isTestMode||!1,console.log("User data loaded:",s)}else await U(t,{userId:this.userId,userName:this.userName,totalPoints:this.totalPoints,pointsData:this.pointsData,isMining:this.isMining,miningStartedAt:this.miningStartedAt,miningEndsAt:this.miningEndsAt,dailyResetTime:B(this.isTestMode),lastUpdated:E(),isTestMode:this.isTestMode}),console.log("User document initialized.")},async saveUserData(){const t=l(r,"users",this.userId);await y(t,{totalPoints:this.totalPoints,isMining:this.isMining,miningEndsAt:this.miningEndsAt}),console.log("User data saved.")},async updateTopUsersCollection(){const t=q(r,"topUsers");console.log("topUsersRef created:",t);const e=l(t,this.userId);await U(e,{userId:this.userId,userName:this.userName||"Unknown",totalPoints:this.totalPoints,lastUpdated:E()},{merge:!0}),console.log("User document updated/created in topUsers");const s=N(t,F("totalPoints","desc"));console.log("topUsersQuery created:",s);const a=await V(s);console.log("topUsersSnapshot fetched:",a.size),this.users=a.docs.map(n=>n.data()),console.log("Top users loaded and sorted:",this.users)},async decrementPoints(t){this.totalPoints-=t,await this.saveUserData(),console.log("Points decremented by",t)},async checkAndStartMining(t){if(await this.loadUserData(),this.isMining)return console.log("Mining is already in progress."),!1;this.isMining=!0,this.miningStartedAt=Date.now(),this.miningEndsAt=this.miningStartedAt+144e5;const e=this.getPoints(t)+4;return this.totalPoints+=4,await this.updateCardPoints(t,e,!0,this.miningStartedAt),await this.saveUserData(),console.log("Mining started."),setTimeout(async()=>{this.finishMining()},144e5),!0},async finishMining(){this.isMining=!1,this.miningStartedAt=null,this.miningEndsAt=null,Object.keys(this.pointsData).forEach(t=>{this.pointsData[t].isButtonDisabled=!1}),await this.saveUserData(),console.log("Mining finished and button re-enabled.")},async updateCardPoints(t,e,s,a){this.pointsData[t]||(this.pointsData[t]={points:0,isButtonDisabled:!1,lastClickedTime:null}),this.pointsData[t].points=e,this.pointsData[t].isButtonDisabled=s,this.pointsData[t].lastClickedTime=a,await this.saveUserData()},async resetPoints(){for(const t in this.pointsData)this.pointsData[t]&&(this.pointsData[t].points=0);this.dailyResetTime=B(this.isTestMode),await this.saveUserData(),console.log("Points reset at:",new Date().toLocaleTimeString())},getPoints(t){return this.pointsData[t]?this.pointsData[t].points:0},calculateNextResetTime(t){const e=new Date;if(t)return e.getTime()+6e4;{let s=new Date(e.getFullYear(),e.getMonth(),e.getDate(),3,0,0);return e>=s&&s.setDate(s.getDate()+1),s.getTime()}},async toggleTestMode(){this.isTestMode=!this.isTestMode,this.dailyResetTime=this.calculateNextResetTime(this.isTestMode),await this.saveUserData()},async loadQuizData(){const t=l(r,"quiz","current"),e=await P(t);if(e.exists()){const s=e.data();this.bank=s.bank!==void 0?s.bank:0,this.correctAnswer=s.correctAnswer||null,this.userAnswers=s.userAnswers||{},this.stakesA=s.stakesA!==void 0?s.stakesA:0,this.stakesB=s.stakesB!==void 0?s.stakesB:0}else await U(t,{bank:0,correctAnswer:null,userAnswers:{},stakesA:0,stakesB:0})},async addToBank(t,e){const s=l(r,"quiz","current"),a=await P(s),w=(a.exists()&&a.data().bank?a.data().bank:0)+t,g=a.exists()&&a.data().stakesA?a.data().stakesA:0,d=a.exists()&&a.data().stakesB?a.data().stakesB:0;let c=g,u=d;e==="А"?c+=t:e==="Б"&&(u+=t),await y(s,{bank:w,stakesA:c,stakesB:u}),this.bank=w,this.stakesA=c,this.stakesB=u},async recordUserAnswer(t,e){const s=l(r,"quiz","current");await y(s,{[`userAnswers.${t}`]:e}),this.userAnswers[t]=e},async setCorrectAnswer(t){this.correctAnswer=t;const e=l(r,"quiz","current");await y(e,{correctAnswer:t}),await this.distributeWinnings()},async distributeWinnings(){const t=Object.keys(this.userAnswers).filter(s=>this.userAnswers[s]===this.correctAnswer);if(t.length>0){const s=this.bank,a=Math.floor(s/t.length);let n=s%t.length;for(const w of t){const g=l(r,"users",w),d=await P(g);if(d.exists()){const c=d.data(),u=a+(n>0?1:0);n>0&&n--,await y(g,{totalPoints:c.totalPoints+u})}}}this.bank=0,this.stakesA=0,this.stakesB=0,this.userAnswers={};const e=l(r,"quiz","current");await U(e,{bank:0,correctAnswer:null,userAnswers:{},stakesA:0,stakesB:0})},async loadTopUsers(){const t=N(q(r,"topUsers"),F("totalPoints","desc")),e=await V(t);this.users=e.docs.map(s=>s.data()),console.log("Top users loaded:",this.users)},startPolling(){const t=this.userId,e=l(r,"users",t);Q(e,a=>{if(a.exists()){const n=a.data();this.pointsData=n.pointsData,this.totalPoints=n.totalPoints,this.isMining=n.isMining||!1,this.miningStartedAt=n.miningStartedAt||null,this.miningEndsAt=n.miningEndsAt||null,this.dailyResetTime=n.dailyResetTime||this.calculateNextResetTime(this.isTestMode),console.log("Data updated from Firestore:",this.pointsData)}});const s=l(r,"quiz","current");Q(s,a=>{if(a.exists()){const n=a.data();this.bank=n.bank,this.correctAnswer=n.correctAnswer,this.userAnswers=n.userAnswers,this.stakesA=n.stakesA,this.stakesB=n.stakesB}})},loadPointsFromLocalStorage(){const t=localStorage.getItem(`points_${this.userId}`);t&&(this.totalPoints=parseInt(t,10))},savePointsToLocalStorage(){localStorage.setItem(`points_${this.userId}`,this.totalPoints.toString())}}});function B(t){const e=new Date;if(t)return e.getTime()+6e4;{let s=new Date(e.getFullYear(),e.getMonth(),e.getDate(),3,0,0);return e>=s&&s.setDate(s.getDate()+1),s.getTime()}}const nt={setup(){const t=at(),e=f(""),s=f(""),a=f(!1),n=f(!1),w=["1227459883","389603194"],g=p(()=>t.bank),d=p(()=>t.stakesA),c=p(()=>t.stakesB),u=p(()=>t.userAnswers),M=f("Usik or Fury?!"),S=f("Usik or Fury?!Who will win in a rematch: Usik (A) or Fury (B)?"),R=f(["А","Б"]),m=p(()=>t.totalPoints),_=p(()=>m.value>=10),z=p(()=>{const o=d.value+c.value;return o?d.value/o*100:0}),L=p(()=>{const o=d.value+c.value;return o?c.value/o*100:0}),G=async o=>{if(console.log("Submitting answer:",o),console.log("UserId:",e.value),_.value&&!a.value){a.value=!0;try{alert("Bid accepted!"),await t.decrementPoints(10),await t.addToBank(10,o),await t.recordUserAnswer(e.value,o)}finally{a.value=!1}}},X=async o=>{console.log("Choosing correct answer:",o),await t.setCorrectAnswer(o)};return H(async()=>{var o;if(window.Telegram&&window.Telegram.WebApp){const C=((o=window.Telegram.WebApp.initDataUnsafe)==null?void 0:o.user)||{};s.value=C.username||"Guest",e.value=C.id?C.id.toString():"Unknown",t.setUser(e.value,s.value),w.includes(e.value)&&(n.value=!0)}else e.value=t.userId;await t.loadUserData(),await t.loadQuizData(),t.startPolling()}),J(()=>t.userAnswers,o=>{console.log("User answers updated:",o)}),{quizTitle:M,quizDescription:S,answers:R,canParticipate:_,submitAnswer:G,chooseCorrectAnswer:X,bank:g,stakesA:d,stakesB:c,userId:e,userName:s,userAnswers:u,percentageA:z,percentageB:L,isSubmitting:a,isAdmin:n}}},v=t=>(tt("data-v-dec176eb"),t=t(),st(),t),it={class:"dark"},ot={style:{"font-size":"14px"}},rt=v(()=>i("img",{style:{width:"50px"},src:"https://cdn3d.iconscout.com/3d/premium/thumb/boxing-gloves-5236962-4379967.png?f=webp"},null,-1)),ct=v(()=>i("br",null,null,-1)),lt=["disabled","onClick"],dt={class:"progress mx-2"},ut=["aria-valuenow"],ht={class:"progress mt-2 mx-2"},gt=["aria-valuenow"],mt={style:{"font-size":"12px"},class:"fw-bold"},pt={class:"text-warning fs-6"},wt={style:{"font-size":"12px"},class:"fw-bold"},ft={class:"text-warning fs-6"},At={style:{"font-size":"12px"},class:"fw-bold"},kt={class:"text-warning fs-6"},_t=v(()=>i("br",null,null,-1)),bt=["onClick"],Dt=v(()=>i("br",null,null,-1)),vt=v(()=>i("br",null,null,-1)),yt=v(()=>i("br",null,null,-1));function xt(t,e,s,a,n,w){const g=A("v-img"),d=A("v-card-title"),c=A("v-divider"),u=A("v-card-subtitle"),M=A("v-card-text"),S=A("v-card-actions"),R=A("v-card");return b(),x(I,null,[D(R,{class:"text-white text-center dark",style:{"margin-top":"110px"}},{default:T(()=>[i("span",it,[D(g,{style:{"box-shadow":"2px 2px 2px 2px rgb(190, 15, 15)"},src:"https://cdn.fakty.com.ua/wp-content/uploads/2024/01/08/usyk-fyuri-promo-632x356.jpg",height:"200px",class:"white--text align-end",cover:""})]),D(d,{class:"text-h6 fw-bold"},{default:T(()=>[k(h(a.quizTitle),1)]),_:1}),D(M,null,{default:T(()=>[i("p",ot,h(a.quizDescription),1),rt,ct,(b(!0),x(I,null,W(a.answers,(m,_)=>(b(),x("button",{key:_,disabled:!a.canParticipate||a.userAnswers[a.userId]!==void 0||a.isSubmitting,class:K(["ma-2 bt btn btn-light text-white",{"btn-green":a.userAnswers[a.userId]===m}]),onClick:z=>a.submitAnswer(m)},h(m),11,lt))),128)),D(c,{class:"my-4"}),i("div",dt,[i("div",{class:"progress-bar bg-primary",role:"progressbar",style:j({width:a.percentageA+"%"}),"aria-valuenow":a.percentageA,"aria-valuemin":"0","aria-valuemax":"100"},h(Math.round(a.percentageA))+"% на А ",13,ut)]),i("div",ht,[i("div",{class:"progress-bar bg-success",role:"progressbar",style:j({width:a.percentageB+"%"}),"aria-valuenow":a.percentageB,"aria-valuemin":"0","aria-valuemax":"100"},h(Math.round(a.percentageB))+"% на Б ",13,gt)]),D(u,{class:"text-center mt-4 fw-bold"},{default:T(()=>[i("h6",mt,[k(" General bank: "),i("span",pt,h(a.bank),1),k(" FVX ")]),i("h6",wt,[k(" Bet on A: "),i("span",ft,h(a.stakesA),1),k(" FVX ")]),i("h6",At,[k(" Bet on B: "),i("span",kt,h(a.stakesB),1),k(" FVX ")])]),_:1})]),_:1}),_t,a.isAdmin?(b(),Z(S,{key:0,class:"justify-center"},{default:T(()=>[(b(!0),x(I,null,W(a.answers,(m,_)=>(b(),x("button",{key:"admin-"+_,class:"btn ma-2 mb-16 bg-warning text-white fw-bold",onClick:z=>a.chooseCorrectAnswer(m)}," Админ "+h(m),9,bt))),128))]),_:1})):$("",!0)]),_:1}),Dt,vt,yt],64)}const Kt=Y(nt,[["render",xt],["__scopeId","data-v-dec176eb"]]);export{Kt as default};
